<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 用来找唯一的 Mapper 文件，一般是 domain 的全路径名 + Mapper -->
<mapper namespace="com.dims.mapper.AdminMapper">
	<!-- 登录 -->
	<select id="login" parameterType="User" resultType="Admin">
		SELECT Ano, Aname, Asex, Aage, Apwd
		FROM Admin
		WHERE Ano = #{no} AND Apwd = #{pwd};
	</select>
	
	<!-- 查看药品库存列表 -->
	<select id="queryAllDrugs" resultType="Drug">
		SELECT d.PDno, d.PDname, d.PDlife, SUM(i.PDnum) AS PDnum
		FROM Drug d, InventoryDrug i
		WHERE d.PDno = i.PDno
		GROUP BY d.PDno, d.PDname, d.PDlife;
	</select>
	
	<!-- 查看某一药品的所有库存批次 -->
	<select id="queryAllPDbatches" parameterType="Drug" resultType="InventoryDrug">
		SELECT d.PDno, d.PDname, d.PDlife, i.PDbatch, i.PDnum, i.Sno, i.SAno, i.Stime
		FROM Drug d, InventoryDrug i
		WHERE d.PDno = i.PDno AND d.PDno = #{PDno};
	</select>
	
	<!-- 参看某一药品的所有已销毁批次 -->
	<select id="queryAllDestroyedPDbatches" parameterType="Drug" resultType="DestroyedDrug">
		SELECT d.PDno, d.PDname, d.PDlife, i.PDbatch, i.PDnum, i.Sno, i.SAno, i.Stime, i.DAno, i.Dtime
		FROM Drug d, InventoryDrug i
		WHERE d.PDno = i.PDno AND d.PDno = #{PDno};
	</select>
	
	<!-- 修改登陆密码 -->
	<update id="changeApwd">
		UPDATE Admin
		SET Apwd = #{arg0}
		WHERE Ano = #{arg1};
	</update>
</mapper>
